<div class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 h-[550px] w-[800px] border border-gray-200 rounded-xl bg-white z-50 p-6">

    <h2 class="text-xl font-semibold mb-4">Selecciona un banco para empezar</h2>

    <!-- Loader visible al inicio -->
    <div id="loading" class="flex-grow flex items-center justify-center">
        <span class="text-gray-500">Cargando instituciones...</span>
    </div>

    <!-- Buscador oculto inicialmente -->
    <input
        type="text"
        id="searchInput"
        placeholder="Buscar banco..."
        class="mb-4 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400 hidden"
    />

    <!-- Contenedor scrollable con cards, oculto inicialmente -->
    <div id="institutionsGrid" class="flex flex-wrap gap-4 overflow-y-auto hidden" style="max-height: 420px;">
        <!-- Aquí irán las cards -->
    </div>
</div>


<script>
    const loadingDiv = document.getElementById('loading');
    const grid = document.getElementById('institutionsGrid');
    const input = document.getElementById('searchInput');
    let institutions = [];
  
    // Función para pintar las cards
    function renderInstitutions(filtered) {
      grid.innerHTML = '';
  
      filtered.forEach(inst => {
        const card = document.createElement('div');
        card.className = "flex flex-col items-center w-[120px] p-3 border border-gray-200 rounded-lg cursor-pointer hover:shadow-md";
  
        card.innerHTML = `
          <img src="${inst.url_img}" alt="${inst.name}" class="w-20 h-20 object-contain mb-2" />
          <span class="text-center text-sm font-medium">${inst.name}</span>
        `;
  
        card.onclick = () => {
          alert("Has seleccionado: " + inst.name);
          // Aquí puedes añadir lógica para cerrar modal o seguir flujo
        };
  
        grid.appendChild(card);
      });
    }
  
    // Evento input para filtro
    input.addEventListener('input', e => {
      const query = e.target.value.toLowerCase();
      const filtered = institutions.filter(inst =>
        inst.name.toLowerCase().includes(query)
      );
      renderInstitutions(filtered);
    });
  
    // Al cargar la página hacemos fetch al backend
    window.addEventListener('DOMContentLoaded', () => {
      fetch('/app/institutions/')
        .then(response => {
          if (!response.ok) throw new Error('Error en la petición');
          return response.json();
        })
        .then(data => {
          institutions = data;
          renderInstitutions(institutions);
  
          // Ocultar loader y mostrar buscador + grid
          loadingDiv.classList.add('hidden');
          input.classList.remove('hidden');
          grid.classList.remove('hidden');
        })
        .catch(error => {
          loadingDiv.innerHTML = '<span class="text-red-500">Error cargando instituciones.</span>';
          console.error(error);
        });
    });
  </script>